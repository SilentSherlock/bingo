var list;var tempShowDiv=$("#community-index #show1");var sortType="time";var thisUser;$(document).ready(function(){function d(g){let user1=null;$.ajax({url:"/person/getUserById?uid=".concat(g),type:"get",async:false,success:function(h){user1=h.resultMap.user;thisUser=user1}});return user1}function c(g){let commentList=null;let formData={idType:"pid",idValue:parseInt(g)}$.ajax({url:"community/getCommentsById",data:formData,type:"get",async:false,success:function(h){commentList=h.resultMap.CommentBypid}});return commentList}function e(){$.get("/community/allPosts",function(g){list=g.resultMap.AllPost;console.log(list);a();f(sortType);b()})}function b(){$("#community-index #show-msg").text("【"+list[0].ptheme+"】"+list[0].title);$("#community-index #link").attr("href","community-talk.html?pid=1");for(var g=2;g<=5;g++){$("#community-index #show-msg"+g).text("【"+list[g].ptheme+"】"+list[g].title);$("#community-index #link").attr("href","post_detail.html?pid="+g);$("#community-index #link").attr("target","_blank")}}function a(){var h="";$(".community-news-list").empty();for(var g=(4<list.length?4:list.length);g>0;g--){h+="<li><a href='javascript:void(0)' onclick='showPostDetail("+list[g-1].pid+")'><span class=content-title><span class=text>【"+list[g-1].ptheme+"】"+list[g-1].title+"</span></span></a></li>"}$("#community-index .community-news-list").html(h)}function f(j){var h="";$("#community-index .community-post-detail").empty();if(j=="time"){list=list.sort(function(s,q){var n=s.ptime.substring(0,10);var r=q.ptime.substring(0,10);var m=s.ptime.substring(11,8);var p=q.ptime.substring(11,8);var u=n.split("-");var t=r.split("-");var o=m.split(":");var i=p.split(":");if(parseInt(u[0])>parseInt(t[0])){return 1}else{if(parseInt(u[0])>parseInt(t[0])){return -1}else{if(parseInt(u[1])>parseInt(t[1])){return 1}else{if(parseInt(u[1])<parseInt(t[1])){return -1}else{if(parseInt(u[2])>parseInt(t[2])){return 1}else{if(parseInt(u[2])<parseInt(t[2])){return -1}else{if(parseInt(o[0])>parseInt(i[0])){return 1}else{if(parseInt(o[0])<parseInt(i[0])){return -1}else{if(parseInt(o[1])>parseInt(i[1])){return 1}else{if(parseInt(o[1])<parseInt(i[1])){return -1}else{if(parseInt(o[2])>parseInt(i[2])){return 1}else{if(parseInt(o[2])<parseInt(i[2])){return -1}else{return 0}}}}}}}}}}}}})}else{if(j=="hot"){list=list.sort(function(m,i){return m.plikenum-i.plikenum})}}for(var g=list.length-1;g>=0;g--){var k=d(list[g].uid);var l=c(list[g].pid);h+="<div class=item-wrap><div class=header><div class=btn></div><a href='javascript:void(0)' onclick='showPostDetail("+list[g].pid+")'><h1 class=h1-in-header>【"+list[g].ptheme+"】"+list[g].title+"</h1></a></div><h2 class=h2-in-header>"+list[g].content+"</h2><div class=left><img src="+k.uavatar+"><a class=nick-name href='javascript:void(0)' onclick='showOtherProfile("+list[g].uid+")'>"+k.ualias+"</a><span class=time>&nbsp;&nbsp;<span>发表于&nbsp;&nbsp;"+list[g].ptime.substring(0,19)+"</span></span></div><div class=btn-wrapper><button class='up' id="+list[g].pid+"><a>点赞"+list[g].plikenum+"</a></button><button class='reply'><a href='javascript:void(0)' onclick='showPostDetail("+list[g].pid+")'>回复"+l.length+"</a></button></div></div></div>"}$(".community-post-detail").html(h)}$("#community-index .type1").click(function(){var h=$("#community-index .active1");var g=$(this);h.removeClass("active1");g.addClass("active1");console.log($(this).val());sortType="time";f(sortType)});$("#community-index .type2").click(function(){var h=$("#community-index .active1");var g=$(this);h.removeClass("active1");g.addClass("active1");console.log($(this).val());sortType="hot";f(sortType)});$(document).on("click","#community-index .up",function(){if(userInfo.uid===undefined){myAlert("请登录后进行操作!");return}var j=$(this).attr("id");var h;for(var k=0;k<list.length;k++){if(list[k].pid==j){h=list[k];console.log(h)}}var g=new FormData();g.append("pid",parseInt(j));g.append("propName","plikenum");let postValue=Number(h.plikenum)+1;g.append("propValue",postValue);JSON.stringify(g);$.ajax({url:"/community/updatePostProp",data:g,type:"post",processData:false,contentType:false,cache:false,async:true,success:function(i){e()}})});$("#community-index #choose1").removeClass("close");$("#community-index #choose1").addClass("active");$("#community-index #tie1").addClass("active1");$("#community-index #show1").show();$("#community-index #show2").hide();$("#community-index #show3").hide();$("#community-index #show4").hide();$("#community-index #show5").hide();e()});$(".close").hover(function(){var b=$("#community-index .active");console.log(b.text());var a=$(this);console.log("tag",a.text());b.removeClass("active");b.addClass("close");a.removeClass("close");a.addClass("active");tempShowDiv.hide();$("#show"+a.text()).show();tempShowDiv=$("#show"+a.text())});