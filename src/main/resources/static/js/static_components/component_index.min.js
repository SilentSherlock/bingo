$(document).ready(function(){loadingAnimation(".recommendation-body-container").then(function(){getRecommendationGameCardHtml().then(function(a){index_init(a)})})});function index_init(a){$.get(requestmap.store_index_carousel,function(b){if(b.status===0){$("#index-carousel-container").hide()}else{let picList=b.resultMap.picList;let gameList=b.resultMap.gameList;let html_indicators="";let html_inner="";$.each(picList,function(c,d){html_inner+="<div class='item'>\n              <a href='javascript:void(0)' onclick='showGameDetail("+gameList[c].gid+")'>                   <img src='/"+d+"' alt='"+gameList[c].gname+"'>               </a>              <div class='carousel-caption'>"+gameList[c].gname+"</div>          </div>";html_indicators+="<li data-target='#index-carousel' data-slide-to='"+c+"'></li>"});$(".carousel-indicators").html(html_indicators);$(".carousel-inner").html(html_inner);$(".carousel-inner .item:eq(0)").addClass("active");$(".carousel-indicators li:eq(0)").addClass("active")}}).fail(function(){$("#index-carousel-container").hide()});restoreSearchConditonDefault();searchCondition.pageIndex=index_pageIndex;searchCondition.pageCount=index_pageCount;showGameByPromotion(a);showGameByScore(a);showFreeGame(a);showNewGame(a);showPreGame(a);setListenerForMoreA();searchCondition.pageIndex=0;searchCondition.pageCount=undefined}function setListenerForMoreA(){$(".recommendation-title-container > span:last-of-type > a").on("click",function(){let type=$(this).parent().prev().text().split("】")[1];restoreSearchConditonDefault();switch(type){case"正在促销":searchCondition.sort="discount";break;case"高评价":searchCondition.sort="score";break;case"免费游戏":searchCondition.minPrice=0;searchCondition.maxPrice=0;break;case"新上线":searchCondition.tag=JSON.stringify(["newsale"]);break;case"即将上线":searchCondition.tag=JSON.stringify(["presale"]);break;default:break}$("nav.navbar ul.navbar-nav:eq(0) > li:eq(0)").removeClass("active");$("nav.navbar ul.navbar-nav:eq(0) > li:eq(1) > a").html(type+"<span class='caret'></span>");$("nav.navbar ul.navbar-nav:eq(0) > li:eq(1)").addClass("active");showAllGame()})}function getRecommendationGameCardHtml(){return new Promise(function(a){$.get(dynamic_components.component_game_recommendation_card.curl,function(b){a(b)})})}function showGameByPromotion(a){searchCondition.sort="discount";searchGame(searchCondition).then(function(b){if(b.status===1){let finalHtml="";$.each(b.resultMap.searchList,function(c,d){let html=$(a);html.find(".index-game-card-cover-container > a").attr("onclick","showGameDetail("+d.gid+")");html.find(".index-game-card-cover-container img").attr("src",d.chref);html.find(".index-game-card-info-container > p").text(d.gname);let save=((1-d.discount)*100).toFixed();html.find(".index-game-card-info-price-container > span").text("-"+save+"%");html.find(".index-game-card-info-price-container > div > span:first-of-type").text("￥"+d.gprice);html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("￥"+d.gprice*d.discount);finalHtml+=html.html()});$("#recommendation-promotion").html(finalHtml)}else{ajaxNoContent("#recommendation-promotion")}},function(){ajaxFailed("#recommendation-promotion")});searchCondition.sort=undefined}function showGameByScore(a){searchCondition.sort="score";searchGame(searchCondition).then(function(b){if(b.status===1){let finalHtml="";$.each(b.resultMap.searchList,function(c,d){let html=$(a);html.find(".index-game-card-cover-container > a").attr("onclick","showGameDetail("+d.gid+")");html.find(".index-game-card-cover-container img").attr("src",d.chref);html.find(".index-game-card-info-container > p").text(d.gname);if(d.gprice===0){html.find(".index-game-card-discount-label").text("免费");html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("免费")}else{if(d.discount===1){html.find(".index-game-card-discount-label").hide();html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("￥"+d.gprice)}else{let save=((1-d.discount)*100).toFixed();html.find(".index-game-card-info-price-container > span").text("-"+save+"%");html.find(".index-game-card-info-price-container > div > span:first-of-type").text("￥"+d.gprice);html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("￥"+d.gprice*d.discount)}}finalHtml+=html.html()});$("#recommendation-score").html(finalHtml)}else{ajaxNoContent("#recommendation-score")}},function(){ajaxFailed("#recommendation-score")});searchCondition.sort=undefined}function showFreeGame(a){searchCondition.minPrice=0;searchCondition.maxPrice=0;searchGame(searchCondition).then(function(b){if(b.status===1){let finalHtml="";$.each(b.resultMap.searchList,function(c,d){let html=$(a);html.find(".index-game-card-cover-container > a").attr("onclick","showGameDetail("+d.gid+")");html.find(".index-game-card-cover-container img").attr("src",d.chref);html.find(".index-game-card-info-container > p").text(d.gname);html.find(".index-game-card-discount-label").text("免费");html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("免费");finalHtml+=html.html()});$("#recommendation-free").html(finalHtml)}else{ajaxNoContent("#recommendation-free")}},function(){ajaxFailed("#recommendation-free")});searchCondition.minPrice=undefined;searchCondition.maxPrice=undefined}function showNewGame(a){searchCondition.tag=JSON.stringify(["newsale"]);searchGame(searchCondition).then(function(b){if(b.status===1){let finalHtml="";$.each(b.resultMap.searchList,function(c,d){let html=$(a);html.find(".index-game-card-cover-container > a").attr("onclick","showGameDetail("+d.gid+")");html.find(".index-game-card-cover-container img").attr("src",d.chref);html.find(".index-game-card-info-container > p").text(d.gname);if(d.gprice===0){html.find(".index-game-card-discount-label").text("免费");html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("免费")}else{if(d.discount===1){html.find(".index-game-card-discount-label").hide();html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("￥"+d.gprice)}else{let save=((1-d.discount)*100).toFixed();html.find(".index-game-card-info-price-container > span").text("-"+save+"%");html.find(".index-game-card-info-price-container > div > span:first-of-type").text("￥"+d.gprice);html.find(".index-game-card-info-price-container > div > span:last-of-type").css("color","rgb(255, 105, 0)");html.find(".index-game-card-info-price-container > div > span:last-of-type").text("￥"+d.gprice*d.discount)}}finalHtml+=html.html()});$("#recommendation-new").html(finalHtml)}else{ajaxNoContent("#recommendation-new")}},function(){ajaxFailed("#recommendation-new")});searchCondition.tag=undefined}function showPreGame(a){searchCondition.tag=JSON.stringify(["presale"]);searchGame(searchCondition).then(function(b){if(b.status===1){let finalHtml="";$.each(b.resultMap.searchList,function(c,d){let html=$(a);html.find(".index-game-card-cover-container > a").attr("onclick","showGameDetail("+d.gid+")");html.find(".index-game-card-cover-container img").attr("src",d.chref);html.find(".index-game-card-info-container > p").text(d.gname);html.find(".index-game-card-discount-label").text("即将上线");html.find(".index-game-card-info-price-container > span").hide();html.find(".index-game-card-info-price-container > div > span:first-of-type").hide();html.find(".index-game-card-info-price-container > div > span:last-of-type").css("margin-top","15px");html.find(".index-game-card-info-price-container > div > span:last-of-type").text(d.realeasedate.split(" ")[0]);finalHtml+=html.html()});$("#recommendation-pre").html(finalHtml)}else{ajaxNoContent("#recommendation-pre")}},function(){ajaxFailed("#recommendation-pre")});searchCondition.tag=undefined};