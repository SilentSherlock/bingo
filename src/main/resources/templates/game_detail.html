<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>起飞的郭家栋</title>
    <script type="text/javascript" src="extlib/jquery-3.5.1/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/detail.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script type="text/css" src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</head>
<body>
<div class="game-detail">
    <div class="detail-main">
        <h3 class="title"><span id="title">樱岛麻衣</span></h3>
        <div class="titile-content-left">
            <div class="titile-content-left-1">
                <div class="content">
                    <div class="videos-player default-height" id="show">
                        <video class="videoPlayer" id="videoPlayer"  src="" controls="controls"  autobuffer muted >
                        </video>
                    </div>
                    <div class="show-list">
                        <div class="show-elem">
                            <img src="" id="video" onclick="change(this)">
                            <div class="player" id="videochild" onclick="change(this)">
                                <span class="glyphicon glyphicon-expand" id="videochild"></span>
                            </div>
                        </div>
                        <div class="show-elem" >
                            <img src="" id="elem1" onclick="change(this)">
                        </div>
                        <div class="show-elem">
                            <img src="" id="elem2" onclick="change(this)">
                        </div>
                        <div class="show-elem">
                            <img src="" id="elem3" onclick="change(this)">
                        </div>
                        <div class="show-elem">
                            <img src="" id="elem4" onclick="change(this)">
                        </div>
                        <div class="show-elem">
                            <img src="" id="elem5" onclick="change(this)">
                        </div>
                        <div class="show-elem">
                            <img src="" id="elem6" onclick="change(this)">
                        </div>
                    </div>
                </div>
            </div>
            <div class="titile-content-left-3">
                <div class="titile-content-left-3-b">
                    <div class="titile-content-left-3-1">配置需求</div>
                </div>
                <div class="titile-content-left-3-2">
                    <div class="titile-content-left-3-2-1">
                        <div class="titile-deploy">最低配置</div>
                        <table class="main-table">
                            <tbody>
                            <tr class="t1">
                                <td class="lab">操作系统</td>
                                <td class="txt" id="os1"></td>
                            </tr>
                            <tr>
                                <td class="lab">内存</td>
                                <td class="txt" id="ram1"></td>
                            </tr>
                            <tr class="t1">
                                <td class="lab">处理器</td>
                                <td class="txt" id="cpu1"></td>
                            </tr>
                            <tr>
                                <td class="lab">显卡</td>
                                <td class="txt" id="gpu1"></td>
                            </tr>
                            <tr class="t1">
                                <td class="lab">硬盘</td>
                                <td class="txt" id="harddisk1"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="titile-content-left-3-2-2">
                        <div class="titile-deploy">推荐配置</div>

                        <table class="main-table">
                            <tbody>
                            <tr class="t1">
                                <td class="lab">操作系统</td>
                                <td class="txt" id="os2"></td>
                            </tr>
                            <tr>
                                <td class="lab">内存</td>
                                <td class="txt" id="ram2"></td>
                            </tr>
                            <tr class="t1">
                                <td class="lab">处理器</td>
                                <td class="txt" id="cpu2"></td>
                            </tr>
                            <tr>
                                <td class="lab">显卡</td>
                                <td class="txt" id="gpu2"></td>
                            </tr>
                            <tr class="t1">
                                <td class="lab">硬盘</td>
                                <td class="txt" id="harddisk2"></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="titile-content-left-2">
                <h3 class="titile-one">游戏评分</h3>
                <div class="titile-two">
                    <div class="score-1">
                        <div class="score-1-1" id="gscore"></div>
                        <div class="score-1-2" id="gstar">
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star-fill star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path  d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                            </svg>
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star-fill star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
                            </svg>
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                            </svg>
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                            </svg>
                            <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-star star" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="titile-three">
                    <div class="score-1-3" id="scoreElem">
                        <!--<div class="sElem" id="scoreElem1"></div>
                        <div class="sElem" id="scoreElem2"></div>
                        <div class="sElem" id="scoreElem3"></div>
                        <div class="sElem" id="scoreElem4"></div>
                        <div class="sElem" id="scoreElem5"></div>-->
                    </div>
                </div>
            </div>
        </div>
        <div class="titile-content-right">
            <div class="titile-content-right-1">
                <div class="titile-content-1-2">
                    <div class="d-cover">
                        <img src="" class="cover" id="cover" alt="封面">
                    </div>
                    <div class="titile-two">
                        <p id="detail"></p>
                    </div>
                </div>
                <div class="tag-list" >
                    <div class="tag" id="gtype">动作</div>
                </div>
                <div class="sale-info">
                    <div>
                        <div class="off-discount">
                            <div class="off-count" id="discount">-35%</div>
                        </div>
                        <div class="list-price" id="gprice">￥268</div>
                        <div class="true-price" id="realPrice">￥174</div>
                    </div>
                </div>
                <div class="box-buy">
                    <div>
                        <div class="box-bts">
                            <button class="shoopingcat" onclick="addCar()">加入购物车</button>
                        </div>
                        <div class="buy">
                            <button class="tobuy" onclick="buy()">立即购买</button>
                        </div>
                    </div>
                </div>
                <div class="wish">
                    <button  class="addwish" onclick="addWishList()">
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-heart" fill="currentColor" xmlns="http://www.w3.org/2000/svg" >
                            <path fill-rule="evenodd" d="M8 2.748l-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                        </svg>
                        <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-heart-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg" hidden="true" >
                            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/>
                        </svg>加入心愿单
                    </button>
                </div>
            </div>
            <div class="titile-content-right-2">
                <div class="item-info">
                    <div class="item-label">开发商</div>
                    <div class="item-content">
                        <div class="item" id="developer">2K</div>
                    </div>
                    <div class="item-label">发行商</div>
                    <div class="item-content">
                        <div class="item" id="publisher">2K</div>
                    </div>
                    <div class="item-label">发行日期</div>
                    <div class="item-content">
                        <div class="item" id="realeasedate">2017/2/22</div>
                    </div>
                    <div class="item-label">语言</div>
                    <div class="item-content">
                        <div class="item" id="language">中文</div>
                    </div>
                    <div class="item-label">支持系统</div>
                    <div class="item-content">
                        <div class="item" id="platform">win</div>
                    </div>
                </div>
            </div>
            <div class="titile-content-right-3" id="addContent" hidden>
                <div class="item-info">
                    <br>
                    <span>评论内容:</span><input type="text" id="content-txt" style="width:200px;height:80px;"></br>
                    <span>评&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分:</span><input type="number" id="content-score" oninput="if(value>10)value=10;if(value<0)value=0"></br>
                    <button type="submit" id="submit">提交评测</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    var game,systemReq
    var systemResult
    var GAMEID
    var GAMEINFO
    var videohref
    //
    function change(typp) {
        console.log("点击元素:"+$(typp).attr("id"));
        if ($(typp).attr("id") === "video" || $(typp).attr("id") === "videochild") {
            document.getElementById("show").innerHTML = "<video class=\"videoPlayer\" src="+game.vhref +" id=\"videoPlayer\" controls=\"controls\"  autobuffer muted >\n" +
                "</video>"
        } else {
            document.getElementById("show").innerHTML = "<img src=" + $(typp).attr("src") + " class='default-height' />";
        }
    }
    //根据分数显示星星
    function star(score,string){
        var sc=9,i,item=5;
        for(i=score;i>=2;i-=2)
        {
            string = "<svg width=\"1em\" height=\"1em\" viewBox=\"0 0 16 16\" class=\"bi bi-star-fill star\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n" +
                "<path  d=\"M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.283.95l-3.523 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z\"/>\n" +
                "</svg>"+string;
            item-=1;
        }
        for(item;item>0;item--){
            string = string+"<svg width=\"1em\" height=\"1em\" viewBox=\"0 0 16 16\" class=\"bi bi-star star\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n" +
                "<path fill-rule=\"evenodd\" d=\"M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.523-3.356c.329-.314.158-.888-.283-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767l-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288l1.847-3.658 1.846 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.564.564 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z\"/>\n" +
                "</svg>";
        }
        return string;
    }
    function addCar(){//加入购物车
        /* num = window.prompt("输入购买数量");
         if(isNaN(buynum=parseInt(num,10))){
             window.alert("请输入整数!!!");
         }
         else{
             sessionStorage.getItem("shoppingcar");
             //加入购物车
             var i=0,keylist = [];
             var charac = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345678";
             for(; i<buynum;i++){
                 var key = "";
                 var temp1= Math.random()*57;
                 var temp2= Math.random()*57;
                 var temp3= Math.random()*57;
                 var temp4= Math.random()*57;
                 var temp5= Math.random()*57;
                 key += charac.charAt(temp1) + charac.charAt(temp2)+ charac.charAt(temp3)+ charac.charAt(temp4)+ charac.charAt(temp5);
                 keylist.push(key);
             }
             console.log("key为: "+keylist);*/
        var item = {
            "gid" : parseInt(GAMEID),
            "discount" : game.discount,
            "price" : game.gprice,
            "gname" : game.gname,
            "chref" : game.chref
        }
        var shoppingcar = [],exist=0;
        //判断购物车是否为空或购物车不存在
        if(localStorage.getItem("shoppingcar")==null || (JSON.parse(localStorage.getItem("shoppingcar")))[0]==null);
        else{
            exist=1;//购物车存在，但商品不在购物车中;
            console.log("购物车存在")
            shoppingcar = JSON.parse(localStorage.getItem("shoppingcar"));
            var i=0,length = shoppingcar.length;
            for( ;i<length;i++){
                if(JSON.parse(shoppingcar[i]==null)){
                    delete shoppingcar[i];
                }
                else
                if(GAMEID==shoppingcar[i].gid){
                    exist=2;
                    console.log("购物车存在，商品在购物车中")
                    window.alert("已加入购物车，请勿重复添加！");
                    break;
                }
            }
        }
        if(exist==0 || exist ==1){//购物车中没有该商品
            shoppingcar.push(item);
            localStorage.setItem("shoppingcar",JSON.stringify(shoppingcar));
            /*car = localStorage.getItem("shoppingcar");
            carContent = JSON.parse(car);
            console.log(carContent);
            console.log(carContent[0]);*/
            window.alert("加入购物车成功！");
        }
    }
    function buy(){//购买，向后台发送插入订单请求
        var num,gnum=1,buynum;
        num = window.prompt("输入购买数量");
        if(isNaN(buynum=parseInt(num,10))){
            window.alert("请输入整数!!!");
        }
        else{
            console.log("购买数量为: "+buynum);
            //插入订单
            var i=0,keylist = [];
            var charac = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz012345678";
            for(; i<buynum;i++){
                var key = "";
                var temp1= Math.random()*57;
                var temp2= Math.random()*57;
                var temp3= Math.random()*57;
                var temp4= Math.random()*57;
                var temp5= Math.random()*57;
                key += charac.charAt(temp1) + charac.charAt(temp2)+ charac.charAt(temp3)+ charac.charAt(temp4)+ charac.charAt(temp5);
                keylist.push(key);
                console.log("生成的key为: " + key )
            }
            var myDate = new Date();
            var orDetails = [{
                gid : GAMEID,
                klist : keylist,
                discount : game.discount,
                price : game.gprice
            }]
            var orderContent = {
                uid : 1,
                otime : myDate,
                orderDetails : JSON.stringify(orDetails)
            }
            console.log(orderContent);
            $.post(
                "store/orderListAddHandle",
                orderContent,
                function (result){
                    console.log(result);
                }
            )
            var gids = [];
            gids.push(parseInt(GAMEID));
            var data = {
                uid : 1,
                gid : JSON.stringify(gids),
                mode : 1
            }
            console.log(JSON.stringify(gids));
            $.post(
                "/person/updateGameListById",data,
                function (result){
                    console.log(result);
                }
            );
            window.alert("购买成功！");
        }
    }
    function addWishList(){
        var data = {
            uid : 1
        }
        $.get(
            "/person/getUserById",data,
            function (result){
                console.log(result);
                wishlist = result.resultMap.wishList;
                console.log(wishlist);
                var i=0,exist=0;
                if(wishlist==null);
                else {
                   var length=wishlist.length;
                    for( ;i<length;i++){
                    console.log(wishlist[i].gid);
                    console.log(GAMEID);
                    if(GAMEID==wishlist[i].gid)
                    {
                        exist=1;
                        break;
                    }
                }
                }
                if(exist==1){
                    window.alert("已在心愿单中！请勿重复添加");
                }
                else {
                    var data = {
                        uid : 1,
                        gid : GAMEID,
                        mode : 1
                    }
                    $.post(
                        "/person/updateWishListById", data,
                        function (result){
                            console.log(result);
                        }
                    )
                    window.alert("加入心愿单成功！");
                }
            }
        )
    }
    $(document).ready(function () {
        //获取游戏ID
        var loc = location.href;
        var n1 = loc.length;
        var n2 = loc.indexOf('=');
        GAMEID = decodeURI(loc.substr(n2+1,n1-n2));
        function getinfo(){
            var data = {
                id : GAMEID
            };
            //更改游戏信息
            $.get("store/gameDetailShow", data,
                function (result){
                    game = result.resultMap.game;
                    //
                    console.log(result);
                    document.getElementById("title").innerText=game.gname;
                    document.getElementById("detail").innerText=game.detail;
                    document.getElementById("cover").src=game.chref;
                    videohref = game.vhref;
                    console.log(videohref);
                    //显示视频
                    document.getElementById("show").innerHTML = "<video class=\"videoPlayer\" src=\"" + game.vhref + "\" " +"id=\"videoPlayer\"  controls=\"controls\"  autobuffer muted >\n"  + "</video>";

                    //截取第一帧做封面
                    var canvas = document.createElement("canvas");
                    video = document.getElementById("videoPlayer");
                    canvas.width = 145;
                    canvas.height = 82;
                    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
                    console.log();
                    document.getElementById("video").src=canvas.toDataURL("image/png");
                    console.log("图片源: "+canvas.toDataURL("image/png"));

                    document.getElementById("elem1").src=game.phref;
                    document.getElementById("elem2").src=game.phref;
                    document.getElementById("elem3").src=game.phref;
                    document.getElementById("elem4").src=game.phref;
                    document.getElementById("elem5").src=game.phref;
                    document.getElementById("elem6").src=game.phref;
                    document.getElementById("developer").innerText=game.developer;
                    document.getElementById("publisher").innerText=game.publisher;
                    document.getElementById("realeasedate").innerText=game.realeasedate.substr(0,10);
                    var time = game.realeasedate;
                    console.log("发行时间:" + time);
                    console.log(typeof  game.realeasedate);
                    var temp = JSON.parse(game.platform);
                    document.getElementById("platform").innerText=temp;
                    temp = JSON.parse(game.language);
                    document.getElementById("language").innerText=temp;
                    temp = JSON.parse(game.gtype);
                    document.getElementById("gtype").innerText=temp;
                    document.getElementById("discount").innerText="" + game.discount*100 + "%";
                    document.getElementById("realPrice").innerText="￥" + game.discount * game.gprice ;
                    document.getElementById("gprice").innerText="￥" + game.gprice;
                    //提取游戏配置信息
                    systemReq = JSON.parse(game.systemreq);
                    //显示游戏评分
                    $("#gscore").text(game.gscore);
                    var score = parseInt(game.gscore);
                    var html = "";
                    html = star(score,html);
                    $("#gstar").html(html);
                    //显示最低配置
                    function getsystem1() {
                        var data = {
                            id: systemReq[0]
                        };
                        $.get("store/systemReqShow", data,
                            function (sysResult) {
                                systemResult = sysResult.resultMap.systemReq;
                                // console.log(systemResult);
                                document.getElementById("cpu1").innerText=systemResult.cpu;
                                document.getElementById("gpu1").innerText=systemResult.gpu;
                                document.getElementById("os1").innerText=systemResult.os;
                                document.getElementById("ram1").innerText=systemResult.ram;
                                document.getElementById("harddisk1").innerText=systemResult.harddisk;
                            })
                    }
                    //显示推荐配置
                    function getsystem2() {
                        var data = {
                            id: systemReq[1]
                        };
                        $.get("store/systemReqShow", data,
                            function (sysResult) {
                                systemResult = sysResult.resultMap.systemReq;
                                // console.log("查询配置2")
                                // console.log(systemResult);
                                document.getElementById("cpu2").innerText=systemResult.cpu;
                                document.getElementById("gpu2").innerText=systemResult.gpu;
                                document.getElementById("os2").innerText=systemResult.os;
                                document.getElementById("ram2").innerText=systemResult.ram;
                                document.getElementById("harddisk2").innerText=systemResult.harddisk;
                            })
                    }
                    getsystem1()
                    getsystem2()
                }
            )
        }
        //显示评测信息
        function getEvaluation(){
            var data = {
                idType : "gid",
                idValue : GAMEID
            }
            $.get(
                "store/evaluationShow", data,
                function (evaList){
                    var conList = evaList.resultMap.evaluationList_gid;
                    var i = 0,item=0;//item控制显示评论数目
                    var html="",html1="",html2="",html3="";
                    $.each(conList, function (key, value){
                        //先行添加头像和昵称，然后加载评论内容
                        $.get(
                            "/person/getUserById" +"?uid="+ value.uid,
                            function (userResult){
                                // var html="";
                                // console.log(value);
                                var user=userResult.resultMap.user;
                                html1="<div class=\"sElem\"><div class=\"score-1-3-1\">\n" +
                                    "                            <div class=\"Avatar\">\n" +
                                    "                                <img class=\"uAvatar\" src="+user.uavatar+">\n" +
                                    "                            </div>\n" +
                                    "                            <div class=\"uname\">"+user.ualias+"</div>\n" +
                                    "                        </div>"
                                //加载评论
                                html1+="<div class=\"score-1-3-2\">\n" +
                                    "                            <div class=\"score1\">\n";
                                //加载星星
                                html2=star(value.score,"") ;
                                html3=
                                    "\n" +
                                    "                            </div>\n" +
                                    "                            <div class=\"score2\">发布于<span>" +value.etime+ "</span></div>\n" +
                                    "                            <div class=\"score3\">" +value.content+ "</div>\n" +
                                    "                        </div></div>";
                                html=html1+html2+html3;
                                // console.log("加载一条评论");
                                var tempID= "#scoreElem" + (key+1) ;
                                // console.log(tempID);
                                $("#scoreElem").append(html);
                            }
                        )
                    })
                }
            )
        }
        //设定是否显示评测入口，只在用户有游戏且未评价的情况下显示入口
        function setEvaluation(){
            var data = {
                uid : 1
            };
            //查询是否有此游戏
            $.get("/person/getUserById", data,
                function (result){
                    //获取游戏ID
                    var loc = location.href;
                    var n1 = loc.length;
                    var n2 = loc.indexOf('=');
                    var txt = decodeURI(loc.substr(n2+1,n1-n2));

                    console.log("游戏ID: " + txt);
                    gamelist = JSON.parse(result.resultMap.user.gamelist);
                    console.log(gamelist);
                    var i=0,j=gamelist.length,ok=0;
                    for( ;i<j;i++){
                        console.log("查找到的游戏ID: "+gamelist[i])
                        if(txt == gamelist[i])
                        {
                            ok=1;//用户拥有此游戏
                            console.log("用户拥有此游戏");
                            break;
                        }
                    }
                    if(ok==1){
                        //查找用户是否评论过
                        var data = {
                            gid : txt,
                            uid : 1
                        }
                        $.get(
                            "store/searchEvaluationByUidAndGid", data,
                            function (result){
                                if(result.status == 0){
                                    //添加入口
                                    console.log("用户暂未评论");
                                    $("#addContent").show();
                                }
                            })
                    }
                })
        }
        $("#submit").click(function (){
            //获取游戏ID
            var loc = location.href;
            var n1 = loc.length;
            var n2 = loc.indexOf('=');
            var txt = decodeURI(loc.substr(n2+1,n1-n2));

            var myDate = new Date();
            if($("#content-txt").val()!="" && $("#content-score").val()!=""){
                var data = {
                    uid : 1,
                    gid : txt,
                    content : $("#content-txt").val(),
                    score : $("#content-score").val(),
                    etime : myDate.toLocaleDateString()
                }
                $.get(
                    "store/evaluationAddHandle" , data,
                    function (result){
                        console.log(result);
                    }
                )
                window.location.reload();
            }
        })
        getinfo()
        getEvaluation()
        setEvaluation()
    })
</script>
</body>
</html>